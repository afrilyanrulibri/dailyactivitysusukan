<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DAILY ACTIVITY - UNIT SUSUKAN</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
 <header style="text-align: center; padding: 20px 0;">
  <h1 style="font-size: 24px; margin: 0; line-height: 0.5;">
    DAILY ACTIVITY<br>
    BRI UNIT SUSUKAN
  </h1>
</header>

  <main>
    <label for="activity">ACTIVITY</label>
    <select id="activity">
      <option>OTS Pinjaman</option>
      <option>PUS</option>
      <option>QRIS</option>
      <option>SIMPANAN</option>
    </select>

    <label for="pekerja">NAMA PEKERJA</label>
    <select id="pekerja">
      <option>00156802 - EKOWATI CAHYANINGROM</option>
      <option>00189290 - MEGA BAGUS KURNIAWAN ABADI</option>
      <option>00189417 - DEDDY NOVIYANTO B.S</option>
      <option>00213122 - RISKA AGUSTIANA</option>
      <option>00270609 - SULISTIYO RINI</option>
      <option>00288133 - GALIH RIO PAMBUDI</option>
    </select>

    <label for="nasabah">NAMA NASABAH / MERCHANT</label>
    <input type="text" id="nasabah" placeholder="Tulis nama nasabah...">

    <label for="uploadFoto">UPLOAD FOTO</label>
    <input type="file" id="uploadFoto" accept="image/*" multiple capture="environment">
    <progress id="progressBar" value="0" max="100" style="width:100%; display:none;"></progress>
    <button onclick="uploadFoto()">Upload Foto</button>

    <br><br>
    <button onclick="shareLocation()">SHARE LOCATION</button>
    <p id="lokasi"></p>
  </main>

  <script>
    let currentLatitude = null;
    let currentLongitude = null;
    let uploadedFileLinks = [];

    function shareLocation() {
      const lokasiText = document.getElementById("lokasi");
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            currentLatitude = position.coords.latitude;
            currentLongitude = position.coords.longitude;
            lokasiText.textContent = `Lokasi: Latitude ${currentLatitude}, Longitude ${currentLongitude}`;
          },
          () => lokasiText.textContent = "‚ùå Gagal mengambil lokasi."
        );
      } else {
        lokasiText.textContent = "‚ùå Geolocation tidak didukung di perangkat ini.";
      }
    }

    async function uploadFoto() {
      const fileInput = document.getElementById("uploadFoto");
      const files = fileInput.files;
      const progressBar = document.getElementById("progressBar");

      if (!files.length) {
        alert("üì∑ Silakan pilih file foto terlebih dahulu!");
        return;
      }

      uploadedFileLinks = [];
      progressBar.style.display = "block";
      progressBar.value = 0;

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const reader = new FileReader();

        reader.onloadend = async () => {
          const base64 = reader.result.split(",")[1];
          const data = new URLSearchParams();
          data.append("file", base64);
          data.append("filename", file.name);
          data.append("mimeType", file.type);

          try {
            const response = await fetch("https://script.google.com/macros/s/AKfycbwvUkc-VjA1aYFJR57dWOcyT57k9j4q7mq7s59PAHt2POJODLBNqvvJQnwUXK-I6wLV/exec", {
              method: "POST",
              body: data,
            });
            const result = await response.text();
            uploadedFileLinks.push(result);
            progressBar.value = ((i + 1) / files.length) * 100;
            if (i === files.length - 1) {
              alert("‚úÖ Foto berhasil diupload" );
              progressBar.style.display = "none";
            }
          } catch (err) {
            alert("‚ùå Gagal upload: " + err.message);
            progressBar.style.display = "none";
          }
        };

        reader.readAsDataURL(file);
      }
    }
  </script>
</body>
</html>
